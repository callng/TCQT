<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TCQT</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body {
          background-color: #f8f9fa;
          color: #333;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
          padding: 20px 10px;
        }

        .container {
          max-width: 600px;
          margin: 0 auto;
          display: none;
        }

        .card {
          border: none;
          border-radius: 16px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
          overflow: hidden;
          background-color: #fff;
        }

        .card-header {
          background-color: #fff;
          border-bottom: 1px solid #eee;
          padding: 24px;
          text-align: center;
        }

        .card-header h2 {
          font-weight: 600;
          color: #1a73e8;
          margin: 0 0 8px 0;
        }

        .version-info {
          font-size: 0.9rem;
          color: #666;
        }

        .version-success {
          color: #28a745;
          font-weight: 600;
        }

        .version-fail {
          color: #dc3545;
          font-weight: 500;
        }

        .list-group-item {
          border: none;
          padding: 16px 24px;
          border-bottom: 1px solid #f0f0f0;
          transition: background-color 0.2s ease;
          cursor: pointer;
        }

        .list-group-item:hover {
          background-color: #f8f9fc;
        }

        .feature-label {
          font-weight: 600;
          font-size: 1.05rem;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .feature-label i {
          opacity: 0.6;
          font-size: 0.9rem;
        }

        .feature-desc {
          font-size: 0.92rem;
          color: #555;
          margin: 10px 0 0;
          opacity: 0;
          max-height: 0;
          overflow: hidden;
          transition: all 0.3s ease;
        }

        .feature-desc.show {
          opacity: 1;
          max-height: 100px;
          margin: 10px 0;
        }

        /* å¼€å…³éƒ¨åˆ†ï¼šä¿ç•™åŸç”ŸåŠ¨ç”»ï¼Œå¢åŠ é˜´å½±å’Œç„¦ç‚¹å…‰æ™• */
        .form-switch .form-check-input {
          /* ä¸æ”¹å®½é«˜ã€è¾¹æ¡†é¢œè‰²ï¼Œä¿ç•™é»˜è®¤åŠ¨ç”» */
          box-shadow: 0 0 6px rgba(26, 115, 232, 0.6);
          transition: box-shadow 0.3s ease, transform 0.2s ease;
        }

        .form-switch .form-check-input:focus {
          box-shadow: 0 0 8px 3px rgba(26, 115, 232, 0.75);
          outline: none;
        }

        .form-switch .form-check-input:hover {
          transform: scale(1.05);
          box-shadow: 0 0 10px 4px rgba(26, 115, 232, 0.85);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-save {
          margin: 24px 24px 24px;
          padding: 12px;
          font-size: 1.1rem;
          border-radius: 12px;
          background-color: #1a73e8;
          border: none;
          box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
          transition: transform 0.1s ease, box-shadow 0.2s ease;
          color: white;
          user-select: none;
        }

        .btn-save:hover:not(:disabled) {
          transform: translateY(-1px);
          box-shadow: 0 6px 16px rgba(26, 115, 232, 0.4);
        }

        .btn-save:disabled {
          background-color: #6c757d;
          box-shadow: none;
          cursor: not-allowed;
        }

        /* Toast æç¤º */
        #toast {
          position: fixed;
          bottom: 30px;
          left: 50%;
          transform: translateX(-50%);
          background-color: #333;
          color: white;
          padding: 12px 24px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          display: none;
          z-index: 9999;
          font-size: 0.95rem;
          animation: fadeIn 0.2s, fadeOut 0.2s 1.8s forwards;
          user-select: none;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateX(-50%) translateY(10px); }
          to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }

        /* åŠ è½½åŠ¨ç”»å±…ä¸­ */
        #loading {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
          color: #555;
          user-select: none;
        }

        #loading .spinner-border {
          width: 3rem;
          height: 3rem;
          border-width: 0.3em;
        }
    </style>
</head>
<body>
<!-- åŠ è½½åŠ¨ç”» -->
<div id="loading">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">åŠ è½½ä¸­...</span>
    </div>
    <p class="mt-3">æ­£åœ¨åŠ è½½ï¼Œè¯·ç¨å€™...</p>
</div>
<!-- ä¸»ä½“å†…å®¹ -->
<div class="container">
    <div class="card">
        <div class="card-header">
            <h2><i class="bi bi-gear"></i> TCQT æ¨¡å—</h2>
            <div class="version-info"> å®¿ä¸»ç‰ˆæœ¬: <span id="qqVersion" class="version-fail">åŠ è½½ä¸­...</span><br> æ¨¡å—ç‰ˆæœ¬: <span id="moduleVersion" class="version-fail">åŠ è½½ä¸­...</span>
            </div>
            <small class="text-muted mt-2 d-block"> å¯ç”¨æˆ–ç¦ç”¨åŠŸèƒ½ï¼Œä¿å­˜åé‡å¯å®¿ä¸»ç”Ÿæ•ˆã€‚ </small>
        </div>
        <ul id="feature-list" class="list-group list-group-flush"></ul>
        <button id="btnSave" class="btn-save">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
    </div>
</div>
<!-- Toast æç¤º -->
<div id="toast">å·²ä¿å­˜</div>
<script>
    const features = [
      // { key: "browser_restrict_mitigation", label: "ç»•è¿‡å†…ç½®æµè§ˆå™¨è®¿é—®é™åˆ¶", desc: "å…è®¸ä»»ä½•URLåœ°å€è®¿é—®ï¼Œä¸å†æ‹¦æˆªã€‚" },
      { key: "change_guid", label: "è‡ªå®šä¹‰ GUID", desc: "å¯ç”¨ååœ¨ç™»å½•é¡µé¢é•¿æŒ‰ç™»å½•æŒ‰é’®å³å¯è°ƒå‡ºè®¾ç½®çª—å£ã€‚" },
      { key: "default_bubble", label: "å¼ºåˆ¶ä½¿ç”¨é»˜è®¤æ°”æ³¡", desc: "ä½¿ç”¨é»˜è®¤æ°”æ³¡ï¼Œè®©èŠ±é‡Œèƒ¡å“¨çš„æ°”æ³¡ä¸é‚£ä¹ˆèŠ±é‡Œèƒ¡å“¨ã€‚" },
      { key: "default_font", label: "å¼ºåˆ¶ä½¿ç”¨é»˜è®¤å­—ä½“", desc: "ä½¿ç”¨é»˜è®¤å­—ä½“ï¼Œè®©èŠ±é‡Œèƒ¡å“¨çš„å­—ä½“ä¸é‚£ä¹ˆèŠ±é‡Œèƒ¡å“¨ã€‚" },
      { key: "disable_flash_pic", label: "å°†é—ªç…§è§†ä¸ºæ­£å¸¸å›¾ç‰‡", desc: "å¥½å‹å‘é€çš„é—ªç…§å°†ä½œä¸ºæ­£å¸¸å›¾ç‰‡æ˜¾ç¤ºå¹¶æ·»åŠ ç°æ¡æç¤ºã€‚" },
      { key: "disable_hot_patch", label: "ç¦ç”¨çƒ­è¡¥ä¸", desc: "é¡¾åæ€ä¹‰ï¼Œä½†ä¸ä¼šåˆ é™¤å·²æœ‰çš„çƒ­è¡¥ä¸ã€‚" },
      { key: "disable_reaction_limit", label: "ç¦æ­¢è¿‡æ»¤ååº”è¡¨æƒ…", desc: "å°†æ›´å¤šçš„è¡¨æƒ…ï¼ˆEmojiï¼‰æ˜¾ç¤ºå‡ºæ¥ã€‚" },
      { key: "fake_multi_window_status", label: "ä¼ªé€ å¤šçª—å£çŠ¶æ€", desc: "ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚" },
      { key: "fetch_service", label: "æ¶ˆæ¯é˜²æ’¤å›", desc: "é˜²æ­¢æ¶ˆæ¯è¢«æ’¤å›ï¼Œæ·»åŠ ç°æ¡æç¤ºã€‚" },
      { key: "flag_secure_bypass", label: "ç»•è¿‡FlagSecure", desc: "ç»•è¿‡FlagSecureï¼Œå…è®¸æˆªå›¾å’Œå½•å±ã€‚" },
      { key: "login_check_box_default", label: "è‡ªåŠ¨å‹¾é€‰å¤é€‰æ¡†", desc: "ç™»å½•ç•Œé¢è‡ªåŠ¨å‹¾é€‰å¤é€‰æ¡†ï¼ˆç”¨æˆ·åè®®ï¼Œæœ‰äººçœ‹äº†å—ï¼‰ã€‚" },
      { key: "module_update", label: "æ¨¡å—æ›´æ–°é‡å¯å®¿ä¸»", desc: "å¯ç”¨åï¼Œæ¯æ¬¡æœ¬æ¨¡å—æ›´æ–°åï¼Œå°†è‡ªåŠ¨é‡å¯ï¼ˆæ€æ­»ï¼‰å®¿ä¸»è¿›ç¨‹ã€‚" },
      { key: "one_click_likes", label: "ä¸€é”®20èµ", desc: "å¼€å¯åç‚¹èµæ—¶å°†è‡ªåŠ¨ç‚¹èµ20ä¸ªï¼ˆéSVIPä¸º10ä¸ªï¼‰ã€‚" },
      { key: "poke_no_cool_down", label: "æˆ³ä¸€æˆ³æ— å†·å´", desc: "ç§»é™¤æˆ³ä¸€æˆ³å†·å´æ—¶é—´ã€‚" },
      { key: "remove_qr_login_check", label: "ç§»é™¤æ‰«ç ç™»å½•æ£€æŸ¥", desc: "æ‰«æç›¸å†Œé‡Œçš„äºŒç»´ç æ—¶ä¸å†æ‹¦æˆªç™»å½•ã€‚" },
      { key: "rename_base_apk", label: "é‡å‘½å.apkæ–‡ä»¶", desc: "ä¸Šä¼ ç¾¤æ–‡ä»¶æ—¶è‡ªåŠ¨é‡å‘½å .apk æ–‡ä»¶ï¼Œé˜²æ­¢æ·»åŠ .1ã€‚" },
      { key: "reply_no_at", label: "å›å¤ä¸å¸¦ @", desc: "å›å¤æ¶ˆæ¯æ—¶ä¸æ·»åŠ  @ å¯¹æ–¹ã€‚" },
      { key: "skip_qr_login_wait", label: "è·³è¿‡æ‰«ç ç™»å½•ç­‰å¾…", desc: "æ‰«ç ç™»å½•æ—¶è·³è¿‡å€’è®¡æ—¶ã€‚" }
    ];

    let injected = false;

    function setVersionText(id, text, success) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.classList.remove("version-success", "version-fail");
      el.classList.add(success ? "version-success" : "version-fail");
    }

    async function loadVersions() {
      return new Promise((resolve) => {
        setTimeout(() => {
          if (typeof TCQT !== "undefined") {
            try {
              setVersionText("qqVersion", TCQT.getQQVersion(), true);
              setVersionText("moduleVersion", TCQT.getModuleVersion(), true);
              injected = true;
            } catch (e) {
              console.error("è·å–ç‰ˆæœ¬å¤±è´¥", e);
              setVersionText("qqVersion", "è·å–å¤±è´¥", false);
              setVersionText("moduleVersion", "è·å–å¤±è´¥", false);
              injected = false;
            }
          } else {
            setVersionText("qqVersion", "ç¯å¢ƒå¼‚å¸¸", false);
            setVersionText("moduleVersion", "ç¯å¢ƒå¼‚å¸¸", false);
            injected = false;
          }
          resolve();
        }, 50);
      });
    }

    function renderFeatures() {
      const container = document.getElementById("feature-list");
      container.innerHTML = "";

      features.forEach(feature => {
        const li = document.createElement("li");
        li.className = "list-group-item";

        li.innerHTML = `
          <div class="d-flex justify-content-between align-items-start">
            <div class="flex-grow-1">
              <div class="feature-label">
                <i class="bi bi-chevron-down"></i>
                ${feature.label}
              </div>
              <div class="feature-desc">${feature.desc}</div>
            </div>
            <div class="form-check form-switch ms-3">
              <input class="form-check-input" type="checkbox" id="switch-${feature.key}">
            </div>
          </div>
        `;

        const label = li.querySelector(".feature-label");
        const desc = li.querySelector(".feature-desc");
        const checkbox = li.querySelector("input[type=checkbox]");

        label.addEventListener("click", () => {
          const isShowing = desc.classList.contains("show");
          desc.classList.toggle("show", !isShowing);
          const icon = label.querySelector("i");
          icon.className = isShowing ? "bi bi-chevron-down" : "bi bi-chevron-up";
        });

        // é˜»æ­¢ç‚¹å‡»å¼€å…³æ—¶å†’æ³¡åˆ°çˆ¶å…ƒç´ å¯¼è‡´å±•å¼€æ”¶èµ·
        checkbox.addEventListener("click", e => e.stopPropagation());

        container.appendChild(li);

        if (!injected) {
          checkbox.disabled = true;
        } else {
          try {
            const settingJson = TCQT.getSetting(feature.key);
            const setting = JSON.parse(settingJson);
            checkbox.checked = setting.value;
          } catch (e) {
            console.warn("è·å–è®¾ç½®å¤±è´¥", e);
            checkbox.checked = false;
          }
        }
      });

      document.getElementById("btnSave").disabled = !injected;
    }

    function saveSettings() {
      if (!injected) {
        alert("æ¨¡å—æ¥å£æœªæ³¨å…¥ï¼Œæ— æ³•ä¿å­˜è®¾ç½®");
        return;
      }
      features.forEach(feature => {
        const checked = document.getElementById("switch-" + feature.key).checked;
        try {
          TCQT.setSettingBoolean(feature.key, checked);
        } catch (e) {
          console.error(`è®¾ç½® ${feature.key} å¤±è´¥`, e);
        }
      });
      showToast("è®¾ç½®å·²ä¿å­˜");
    }

    function showToast(msg) {
      if (typeof TCQT !== "undefined") {
        try {
          TCQT.toast(msg);
          return;
        } catch (e) {}
      }
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(() => {
        toast.style.display = "none";
      }, 2000);
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("btnSave").addEventListener("click", saveSettings);
    });

    (async function init() {
      await loadVersions();
      renderFeatures();
      document.getElementById("loading").style.display = "none";
      document.querySelector(".container").style.display = "block";
    })();
</script>
</body>
</html>
